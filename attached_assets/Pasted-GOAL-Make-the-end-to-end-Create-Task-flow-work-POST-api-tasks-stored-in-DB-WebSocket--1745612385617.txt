GOAL
Make the end-to-end â€œCreate Taskâ€ flow work:
  â€¢ POST /api/tasks  âŸ¶ stored in DB
  â€¢ WebSocket â€œtask:newâ€ broadcast fires
  â€¢ React-Query list in <TaskInboxPage> refreshes
  â€¢ After selecting team + urgency, card flips to scheduler and
    PATCH /api/tasks/:id updates scheduled_for + status.

CONTEXT
Repo path examples
  /server/controllers/taskController.ts
  /server/routes.ts
  /server/services/taskService.ts
  /server/websockets/index.ts
  /client/src/pages/TaskInboxPage.tsx
  /client/src/components/tasks/TaskCard.tsx
  /client/src/components/tasks/Scheduler.tsx

SYMPTOMS
â€¢ FE console shows blank list or stale data after creating a task.
â€¢ BE logs â€œZod validation errorâ€ when POSTing.
â€¢ WS â€œtask:newâ€ sometimes missing.
â€¢ Scheduler PATCH 200 OK but UI doesnâ€™t update.

TASKS
1. âœ… UNIT TEST FIRST
   â€¢ Add Vitest + Supertest test:
     â€“ POST /api/tasks  â‡’ 200
     â€“ DB contains new row, ws mock received â€œtask:newâ€.

2. ğŸ” BACKEND DIAGNOSE
   â€¢ Verify Zod schema in taskController matches FE payload:
       { action, description, listingId, listingName, attachments? }
   â€¢ Confirm route path /api/tasks (POST) & /api/tasks/:id (PATCH)
     are registered in server/routes.ts.
   â€¢ Ensure taskService.save() inserts scheduled_for =NULL
     and status='new' by default, then broadcasts.

3. ğŸ”§ BACKEND FIXES
   â€¢ Align Zod schema & DTO to FE payload.
   â€¢ Return complete Task object (id, status, etc.) in response
     and in WS broadcast.

4. ğŸš€ FRONTEND DIAGNOSE
   â€¢ In TaskInboxPage.tsx: React-Query key must include
     status filter â†’ `/api/tasks?status=new`.
   â€¢ After POST success OR ws â€œtask:newâ€, invalidate the same key.
   â€¢ TaskCard optimistic update should mutate Query cache or wait
     for ws â€œtask:updateâ€.

5. ğŸ”§ FRONTEND FIXES
   â€¢ Add useWebSocket hook that listens for task:new / task:update
     and queryClient.invalidateQueries(['tasks','new']).
   â€¢ Ensure TaskCard flips only after both team_target & urgency chosen.
   â€¢ Scheduler.tsx: after PATCH success â†’ broadcast or mutate cache.

6. ğŸ” E2E CHECK
   â€¢ Cypress (or Playwright) test:
     a) Visit /tasks   (list empty)
     b) Click â€œCreate taskâ€, fill dummy, submit.
     c) Expect card to appear without refresh.
     d) Select team + urgency âœ card flips, schedule, PATCH,
        expect status badge 'scheduled'.

7. ğŸ“ CHANGELOG
   â€¢ List updated files, new tests, and any breaking API response change.

ERROR HANDLING
â€¢ All controllers must return 422 with detailed message on Zod failure.
â€¢ WebSocket send wrapped in try/catch â†’ log but donâ€™t crash server.

RUN AFTER CODING
```bash
pnpm db:push --dry-run         # ensure no pending migrations
pnpm lint
pnpm test
